\subsection{OpenWRT backend}
\subsubsection{Application specific traffic statistics}
\label{sec:app-specific-design}

One of our goals in this project is to identify and provide statistics for traffic belonging to specific user applications, for example, identifying how much incoming and outgoing traffic's related with the Youtube application, and knowing which host behind this OpenWRT box is generating these traffic. To achieve this goal, we considered the following design alternatives:

\begin{itemize}

\item Install a service on each user device, which monitors application network usage information from the operating system and reports the monitored statistics to a service on the OpenWRT box. This approach can likely generate more accurate results and provide each specific application's statistics, however, it requires that each user device voluntarily run this service, which is not ideal for our goal: this service should not require additional actions from user devices, and the OpenWRT box should be able to collect statistics with or without end user cooperation.

\item Capture the traffic on the OpenWRT box, and run per-packet analysis. The following information from packet header or payload could be helpful:

  \begin{itemize}

  \item Source and destination IP addresses. 

  Popular service providers, such as Google and Facebook, own large chunks of IP addresses, and certain destination IP address ranges may correspond to servers for a specific application. By collecting such information and building a  mapping from destination IP address to an application's backend services, we can infer the user application that's generating this traffic. The problem with this approach is that this mapping takes time to build, and it's hard for this mapping to change dynamically, especially considering the fact that many popular services are using CDNs.

  \item Source and destination port number. 

  Certain services can be identified by IANA's port number allocation \cite{PortAssignment}, and this information is easily retrievable from the Internet. The problem with this approach, is that the amount of applications that can be identified purely by port number is very limited, for example, the Youtube app and Facebook app on Android both go through port 443 (TLS).

  \item Application layer payload. 

  Decoding application payload and trying to find characteristic plain text is another way to identify which application the packet belongs to. This approach is promising, if such characteristic texts can be found and the payload's not encrypted, which is not the case for most popular applications, such as Youtube or Facebook. Packet capture of these apps on Android shows that their traffic goes on top of TLS, and packet capture of watching Youtube videos on a desktop indicate that the traffic goes on top of QUIC, which has encryption over UDP.

  \item Source and destination host names. 

  DNS host names often give information about the service provider, even when the service provider's using CDNs. By doing a DNS reverse lookup on the IP addresses, we can find out the service's domain name, thus infer what application's generating the traffic. The assumption of this approach is that most servers or CDN boxes do have a DNS name that corresponds to the application backend that they run. Our initial experiments suggest that this assumption is indeed true for popular applications like Youtube and Facebook, though mapping a DNS domain to a certain service may not be straightforward. For example, Facebook app on Android talks to both \textit{*.facebook.com} domain, and \textit{*.fbcdn.net} (owned by the CDN provider, Akamai Technologies) domain, and Youtube app talks to both \textit{*.google.com}, and \textit{*.1e100.net}, another Google owned domain. 

  Given this caveat, the authors chose this approach since it's still more applicable than other options listed above. For a proof-of-concept implementation, the mapping from domain names to service names is statically configured. It's also worth mentioning that this approach will limit our statistics to per service provider, rather than per exact application (for example, we can't differentiate Google Hangout application traffic from Youtube application traffic), but the authors believe this is enough for the purpose of providing statistics on the router end that could give the adminstrator rough ideas of which application on which device is generating how much traffic.

  \end{itemize} 

\end{itemize}

